<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enigma Runic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom right, #141e30, #243b55);
            overflow-y: auto;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        .rune {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border: 2px solid #5a677d;
        }
        .rune:hover {
            transform: scale(1.1);
            border-color: #f7b733;
            box-shadow: 0 0 15px #f7b733;
        }
        .guess-slot {
            border: 2px dashed #4a5568;
            background-color: rgba(0, 0, 0, 0.2);
        }
        .feedback-peg {
            transition: transform 0.3s ease;
        }
        .history-row {
            border-bottom: 1px solid #3a475d;
        }
        .modal {
            display: none;
        }
        .modal.show {
            display: flex;
        }
        /* Animasi loading sederhana */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f7b733;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl text-center">
        <h1 class="text-5xl md:text-6xl font-cinzel font-bold mb-2" style="text-shadow: 0 0 10px #f7b733;">Enigma Runic</h1>
        <p class="mb-4 text-lg text-gray-400">Pecahkan urutan 4 rune rahasia dalam 10 kesempatan.</p>
        <button id="get-prophecy" class="mb-4 bg-teal-600 hover:bg-teal-500 text-white font-bold py-2 px-5 rounded-full text-sm transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-teal-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Dengarkan Ramalan Oracle ✨</button>

        <div id="game-container" class="bg-gray-800 bg-opacity-50 p-6 rounded-2xl shadow-2xl border border-gray-700">
            
            <div class="mb-6">
                <h2 class="text-xl font-cinzel mb-3">Tebakan Anda</h2>
                <div id="current-guess-area" class="flex justify-center items-center space-x-2 md:space-x-4 h-20"></div>
            </div>

            <div class="mb-6">
                 <h2 class="text-xl font-cinzel mb-3">Pilih Rune</h2>
                <div id="rune-selection-area" class="flex flex-wrap justify-center items-center gap-2 md:gap-4 p-4 bg-black bg-opacity-20 rounded-lg"></div>
            </div>
            
            <div class="flex flex-wrap justify-center items-center gap-4">
                 <button id="submit-guess" class="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Tebak</button>
                 <button id="clear-guess" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none">Ulangi</button>
                 <button id="get-hint" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Minta Petunjuk ✨</button>
                 <button id="get-comment" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Komentar Oracle ✨</button>
            </div>
            <button id="ask-question" class="mt-4 bg-orange-700 hover:bg-orange-600 text-white font-bold py-2 px-5 rounded-full text-sm transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-500 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Ritual Pertanyaan (-1) ✨</button>
            <p class="mt-2 text-lg">Sisa Percobaan: <span id="attempts-left" class="font-bold">10</span></p>

        </div>
        
        <div id="history-container" class="w-full mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-xl shadow-lg border border-gray-700 max-h-64 overflow-y-auto">
             <h3 class="text-xl font-cinzel mb-2 sticky top-0 bg-gray-800 bg-opacity-80 py-2">Riwayat</h3>
             <div id="history-log"></div>
        </div>
    </div>

    <!-- Modal Hasil Game -->
    <div id="resultModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 border-yellow-500 max-w-md w-full">
            <h2 id="modal-title" class="text-4xl font-cinzel font-bold mb-4"></h2>
            <p id="modal-message" class="text-lg mb-4"></p>
            <div class="mb-6">
                <p class="text-gray-400">Kode Rahasianya adalah:</p>
                <div id="secret-code-display" class="flex justify-center items-center space-x-2 mt-2"></div>
            </div>
            <div id="gemini-win-features" class="hidden">
                 <button id="get-lore" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-lg text-base mb-4">Ungkap Kisahnya ✨</button>
                 <div id="lore-result" class="text-base text-purple-200 bg-black bg-opacity-20 p-3 rounded-lg min-h-[6rem] flex items-center justify-center"></div>
            </div>
             <div id="gemini-lose-features" class="hidden">
                 <button id="get-analysis" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg text-base mb-4">Analisis Permainan Saya ✨</button>
            </div>
            <button id="restart-button" class="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-400">
                Main Lagi
            </button>
        </div>
    </div>

    <!-- Modal Info Umum (Petunjuk, Analisis, Ramalan, Komentar) -->
    <div id="infoModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div id="info-modal-content-box" class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 max-w-md w-full">
            <h2 id="info-modal-title" class="text-3xl font-cinzel font-bold mb-4"></h2>
            <div id="info-modal-content" class="text-lg mb-6 min-h-[5rem] flex items-center justify-center text-left"></div>
            <button id="close-info-button" class="text-white font-bold py-2 px-6 rounded-lg">Tutup</button>
        </div>
    </div>
    
    <!-- Modal Pertanyaan -->
    <div id="questionModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 border-orange-500 max-w-md w-full">
            <h2 class="text-3xl font-cinzel font-bold mb-4 text-orange-400">Ritual Pertanyaan</h2>
            <p class="mb-4 text-gray-300">Ajukan satu pertanyaan kepada Oracle. Ini akan mengorbankan 1 sisa percobaan.</p>
            <input type="text" id="question-input" class="w-full bg-gray-700 text-white p-2 rounded-md mb-4 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Contoh: Apakah Rune Api ada dalam kode?">
            <div class="flex justify-center gap-4">
                <button id="submit-question" class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-6 rounded-lg">Tanya</button>
                <button id="cancel-question" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // --- Konfigurasi Game ---
        const RUNE_COUNT = 4;
        const MAX_ATTEMPTS = 10;
        const RUNES = [
            { id: 1, name: "Segitiga Api", theme: "api, panas, kehancuran", svg: '<path d="M12 2 L22 22 L2 22 Z" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#ff6b6b' },
            { id: 2, name: "Lingkaran Air", theme: "air, ketenangan, kehidupan", svg: '<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#48dbfb' },
            { id: 3, name: "Mata Angin", theme: "angin, kebebasan, perjalanan", svg: '<path d="M2 12 Q12 2 22 12 Q12 22 2 12 Z" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#1dd1a1' },
            { id: 4, name: "Berlian Tanah", theme: "tanah, kekuatan, kestabilan", svg: '<rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" transform="rotate(45 12 12)"/>', color: '#feca57' },
            { id: 5, name: "Simpul Petir", theme: "petir, energi, kecepatan", svg: '<path d="M2 2 L12 12 L2 22 M22 2 L12 12 L22 22" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#ff9ff3' },
            { id: 6, name: "Salib Roh", theme: "roh, keseimbangan, alam baka", svg: '<path d="M12 2 V22 M2 12 H22" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#54a0ff' }
        ];

        // --- Elemen DOM ---
        const getProphecyBtn = document.getElementById('get-prophecy');
        const getHintBtn = document.getElementById('get-hint');
        const getCommentBtn = document.getElementById('get-comment');
        const askQuestionBtn = document.getElementById('ask-question');
        const questionModal = document.getElementById('questionModal');
        const questionInput = document.getElementById('question-input');
        const submitQuestionBtn = document.getElementById('submit-question');
        const cancelQuestionBtn = document.getElementById('cancel-question');
        const infoModal = document.getElementById('infoModal');
        const infoModalTitle = document.getElementById('info-modal-title');
        const infoModalContent = document.getElementById('info-modal-content');
        const infoModalContentBox = document.getElementById('info-modal-content-box');
        const closeInfoBtn = document.getElementById('close-info-button');
        const getLoreBtn = document.getElementById('get-lore');
        const loreResult = document.getElementById('lore-result');
        const geminiWinFeatures = document.getElementById('gemini-win-features');
        const getAnalysisBtn = document.getElementById('get-analysis');
        const geminiLoseFeatures = document.getElementById('gemini-lose-features');
        const currentGuessArea = document.getElementById('current-guess-area');
        const runeSelectionArea = document.getElementById('rune-selection-area');
        const submitGuessBtn = document.getElementById('submit-guess');
        const clearGuessBtn = document.getElementById('clear-guess');
        const attemptsLeftEl = document.getElementById('attempts-left');
        const historyLog = document.getElementById('history-log');
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const secretCodeDisplay = document.getElementById('secret-code-display');
        const restartButton = document.getElementById('restart-button');

        // --- State Game ---
        let secretCode = [], currentGuess = [], historyData = [];
        let attempts = MAX_ATTEMPTS;
        let isGameOver = false;

        function createRuneElement(rune, isInteractive = false) {
            const runeEl = document.createElement('div');
            runeEl.className = 'rune w-12 h-12 md:w-14 md:h-14 bg-gray-700 rounded-lg flex items-center justify-center';
            runeEl.innerHTML = `<svg viewBox="0 0 24 24" width="28" height="28" style="color: ${rune.color};">${rune.svg}</svg>`;
            if (isInteractive) runeEl.onclick = () => handleRuneSelection(rune);
            return runeEl;
        }

        function initGame() {
            isGameOver = false;
            attempts = MAX_ATTEMPTS;
            currentGuess = [];
            secretCode = [];
            historyData = [];
            
            let availableRunes = [...RUNES];
            for (let i = 0; i < RUNE_COUNT; i++) {
                const randomIndex = Math.floor(Math.random() * availableRunes.length);
                secretCode.push(availableRunes[randomIndex]);
                availableRunes.splice(randomIndex, 1);
            }
            console.log("Kode Rahasia (untuk debugging):", secretCode.map(r => r.name).join(', '));

            runeSelectionArea.innerHTML = '';
            RUNES.forEach(rune => runeSelectionArea.appendChild(createRuneElement(rune, true)));
            
            historyLog.innerHTML = '';
            attemptsLeftEl.textContent = attempts;
            resultModal.classList.remove('show');
            submitGuessBtn.disabled = true;
            getHintBtn.disabled = true;
            getCommentBtn.disabled = true;
            askQuestionBtn.disabled = true;
            getProphecyBtn.disabled = false;
            geminiWinFeatures.classList.add('hidden');
            geminiLoseFeatures.classList.add('hidden');
            loreResult.innerHTML = '';
            getLoreBtn.disabled = false;
            getAnalysisBtn.disabled = false;
            
            renderCurrentGuess();
        }

        function renderCurrentGuess() {
            currentGuessArea.innerHTML = '';
            for(let i = 0; i < RUNE_COUNT; i++) {
                if(currentGuess[i]) {
                    currentGuessArea.appendChild(createRuneElement(currentGuess[i]));
                } else {
                    const slot = document.createElement('div');
                    slot.className = 'guess-slot w-12 h-12 md:w-14 md:h-14 rounded-lg';
                    currentGuessArea.appendChild(slot);
                }
            }
            submitGuessBtn.disabled = currentGuess.length !== RUNE_COUNT;
        }

        function handleRuneSelection(rune) {
            if (isGameOver || currentGuess.length >= RUNE_COUNT) return;
            if (!currentGuess.some(r => r.id === rune.id)) {
                currentGuess.push(rune);
                renderCurrentGuess();
            }
        }
        
        clearGuessBtn.addEventListener('click', () => {
             if (isGameOver) return;
             currentGuess = [];
             renderCurrentGuess();
        });

        submitGuessBtn.addEventListener('click', () => {
            if (isGameOver || currentGuess.length !== RUNE_COUNT) return;
            const { correctPosition, correctRune } = checkGuess();
            historyData.push({ guess: [...currentGuess], feedback: { correctPosition, correctRune }});
            addGuessToHistory(correctPosition, correctRune);
            
            attempts--;
            attemptsLeftEl.textContent = attempts;
            getProphecyBtn.disabled = true;
            
            if (correctPosition === RUNE_COUNT) {
                endGame(true);
            } else if (attempts === 0) {
                endGame(false);
            } else {
                getHintBtn.disabled = false;
                getCommentBtn.disabled = false;
                if(historyData.length >= 2) askQuestionBtn.disabled = false;
            }
            
            currentGuess = [];
            renderCurrentGuess();
        });

        function checkGuess() {
            let correctPosition = 0, correctRune = 0;
            const guessIds = currentGuess.map(r => r.id);
            const secretIds = secretCode.map(r => r.id);
            let checkedGuess = Array(RUNE_COUNT).fill(false);
            let checkedSecret = Array(RUNE_COUNT).fill(false);
            for (let i = 0; i < RUNE_COUNT; i++) {
                if (guessIds[i] === secretIds[i]) {
                    correctPosition++;
                    checkedGuess[i] = true;
                    checkedSecret[i] = true;
                }
            }
            for (let i = 0; i < RUNE_COUNT; i++) {
                if (checkedGuess[i]) continue;
                for (let j = 0; j < RUNE_COUNT; j++) {
                    if (checkedSecret[j]) continue;
                    if (guessIds[i] === secretIds[j]) {
                        correctRune++;
                        checkedSecret[j] = true;
                        break; 
                    }
                }
            }
            return { correctPosition, correctRune };
        }

        function addGuessToHistory(correctPosition, correctRune) {
            const historyRow = document.createElement('div');
            historyRow.className = 'history-row flex justify-between items-center p-2 animate-fade-in';
            const guessDisplay = document.createElement('div');
            guessDisplay.className = 'flex items-center space-x-2';
            currentGuess.forEach(rune => {
                 const runeEl = createRuneElement(rune);
                 runeEl.classList.remove('md:w-14', 'md:h-14');
                 runeEl.classList.add('w-8', 'h-8');
                 runeEl.firstElementChild.setAttribute('width', '20');
                 runeEl.firstElementChild.setAttribute('height', '20');
                 guessDisplay.appendChild(runeEl);
            });
            const feedbackDisplay = document.createElement('div');
            feedbackDisplay.className = 'flex items-center space-x-1';
            for (let i = 0; i < correctPosition; i++) {
                const peg = document.createElement('div');
                peg.className = 'feedback-peg w-4 h-4 rounded-full bg-green-500 border-2 border-green-300';
                feedbackDisplay.appendChild(peg);
            }
             for (let i = 0; i < correctRune; i++) {
                const peg = document.createElement('div');
                peg.className = 'feedback-peg w-4 h-4 rounded-full bg-yellow-500 border-2 border-yellow-300';
                feedbackDisplay.appendChild(peg);
            }
            historyRow.appendChild(guessDisplay);
            historyRow.appendChild(feedbackDisplay);
            historyLog.prepend(historyRow);
        }

        function endGame(isWin) {
            isGameOver = true;
            getHintBtn.disabled = true;
            getProphecyBtn.disabled = true;
            getCommentBtn.disabled = true;
            askQuestionBtn.disabled = true;
            secretCodeDisplay.innerHTML = '';
            secretCode.forEach(rune => secretCodeDisplay.appendChild(createRuneElement(rune)));
            if(isWin) {
                modalTitle.textContent = "Selamat!";
                modalTitle.style.color = '#1dd1a1';
                modalMessage.textContent = `Anda berhasil memecahkan kode dalam ${MAX_ATTEMPTS - attempts} percobaan!`;
                geminiWinFeatures.classList.remove('hidden');
            } else {
                modalTitle.textContent = "Gagal!";
                modalTitle.style.color = '#ff6b6b';
                modalMessage.textContent = "Anda kehabisan percobaan. Coba lagi lain kali.";
                geminiLoseFeatures.classList.remove('hidden');
            }
            resultModal.classList.add('show');
        }
        
        restartButton.addEventListener('click', initGame);
        
        function showInfoModal(title, contentPromise, themeColor) {
            infoModal.classList.add('show');
            infoModalTitle.textContent = title;
            infoModalContentBox.style.borderColor = themeColor;
            closeInfoBtn.style.backgroundColor = themeColor;
            infoModalContent.innerHTML = '<div class="loader"></div>';

            contentPromise.then(content => {
                infoModalContent.innerHTML = `<p class="italic">"${content}"</p>`;
            }).catch(error => {
                console.error("Error showing modal content:", error);
                infoModalContent.textContent = "Terjadi kesalahan saat memuat data.";
            });
        }
        
        closeInfoBtn.addEventListener('click', () => infoModal.classList.remove('show'));

        // --- Fitur Gemini API ---
        async function callGemini(prompt) {
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0].content.parts[0].text) {
                return result.candidates[0].content.parts[0].text.replace(/"/g, '');
            } else {
                throw new Error("No content received from Gemini.");
            }
        }
        
        function getHistoryAsText() {
            let text = '';
            historyData.forEach((item, index) => {
                const guessNames = item.guess.map(r => r.name).join(', ');
                text += `Tebakan ${index + 1}: [${guessNames}], Hasil: ${item.feedback.correctPosition} Hijau, ${item.feedback.correctRune} Kuning.\n`;
            });
            return text;
        }

        getProphecyBtn.addEventListener('click', () => {
            getProphecyBtn.disabled = true;
            const secretThemes = secretCode.map(r => r.theme).join(', ');
            const prompt = `Anda adalah Oracle di game Enigma Runic. Kode rahasia memiliki tema: ${secretThemes}. Berikan ramalan puitis dua kalimat yang samar tentang tema-tema ini tanpa menyebutkan nama atau bentuk rune. Ramalan ini harus dalam bahasa Indonesia. Contoh: 'Kekuatan yang menempa bumi bersatu dengan ketenangan samudra terdalam.'`;
            
            showInfoModal("Ramalan Sang Oracle", callGemini(prompt), '#14b8a6');
        });
        
        getHintBtn.addEventListener('click', () => {
            const prompt = `Anda adalah seorang ahli logika dalam permainan memecahkan kode bernama Enigma Runic. Aturannya adalah menebak urutan 4 rune unik dari 6 pilihan rune. Pilihan rune: ${RUNES.map(r => r.name).join(', ')}. Petunjuk: 'Hijau' berarti 1 rune benar di posisi yang tepat. 'Kuning' berarti 1 rune benar tapi di posisi yang salah. Berikut adalah riwayat tebakan sejauh ini:\n${getHistoryAsText()} Berdasarkan riwayat di atas, berikan satu petunjuk atau deduksi logis yang berguna untuk tebakan selanjutnya. Jangan berikan jawaban langsung. Berikan dalam format singkat dan padat. Berikan dalam bahasa Indonesia.`;
            showInfoModal("Petunjuk dari Sang Oracle", callGemini(prompt), '#3b82f6');
        });

        getCommentBtn.addEventListener('click', () => {
            if (historyData.length === 0) return;
            const lastGuess = historyData[historyData.length - 1];
            const guessNames = lastGuess.guess.map(r => r.name).join(', ');
            const feedback = `${lastGuess.feedback.correctPosition} Hijau, ${lastGuess.feedback.correctRune} Kuning`;
            const prompt = `Anda adalah Oracle yang sedikit sombong dan misterius di game Enigma Runic. Seorang pemain baru saja membuat tebakan [${guessNames}] dan hasilnya adalah ${feedback}. Berikan satu kalimat komentar yang puitis, samar, atau sedikit mengejek tentang tebakan mereka. Jangan berikan petunjuk langsung. Gunakan bahasa Indonesia.`;
            showInfoModal("Komentar Sang Oracle", callGemini(prompt), '#6366f1');
        });
        
        askQuestionBtn.addEventListener('click', () => {
            questionModal.classList.add('show');
        });
        
        cancelQuestionBtn.addEventListener('click', () => {
            questionModal.classList.remove('show');
        });

        submitQuestionBtn.addEventListener('click', () => {
            const question = questionInput.value.trim();
            if (!question) return;

            questionModal.classList.remove('show');
            
            attempts--;
            attemptsLeftEl.textContent = attempts;
            
            const secretRuneNames = secretCode.map(r => r.name);
            const prompt = `Anda adalah Oracle di game Enigma Runic. Anda harus menjawab pertanyaan dari pemain dengan jawaban "Ya" atau "Tidak" yang dibungkus kalimat puitis. Jangan bertele-tele. Konteks kode rahasia: [${secretRuneNames.join(', ')}]. Pertanyaan pemain: "${question}". Jawab dalam bahasa Indonesia.`;
            
            showInfoModal("Jawaban Sang Oracle", callGemini(prompt), '#d97706');
            questionInput.value = '';

            if (attempts === 0) {
                setTimeout(() => endGame(false), 500);
            }
        });


        getLoreBtn.addEventListener('click', async () => {
            getLoreBtn.disabled = true;
            loreResult.innerHTML = '<div class="loader mx-auto"></div>';
            const solvedCodeNames = secretCode.map(r => r.name).join(', ');
            const prompt = `Anda adalah seorang penyair dan penjaga hikayat kuno. Tuliskan sebuah legenda atau cerita pendek (sekitar 2-3 kalimat) tentang sebuah kombinasi rune sakral yang dikenal sebagai "${solvedCodeNames}". Ceritanya harus mistis dan menarik. Gunakan bahasa Indonesia.`;
            
            try {
                const lore = await callGemini(prompt);
                loreResult.innerHTML = `<p>${lore}</p>`;
            } catch (error) {
                loreResult.textContent = "Kisah rune ini telah hilang ditelan waktu.";
            }
        });

        getAnalysisBtn.addEventListener('click', () => {
             const prompt = `Anda adalah seorang pelatih logika yang menganalisis permainan Enigma Runic. Berikan analisis singkat dan satu saran strategis berdasarkan riwayat tebakan pemain berikut. Tujuannya adalah untuk membantu pemain berpikir lebih baik di permainan selanjutnya. Jangan terlalu keras, berikan semangat. Gunakan bahasa Indonesia.\n\nRiwayat Tebakan:\n${getHistoryAsText()}`;
             
             showInfoModal("Analisis Permainan", callGemini(prompt), '#dc2626');
        });

        initGame();
    </script>
</body>
</html>
