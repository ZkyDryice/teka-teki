<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zky's Enigma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom right, #141e30, #243b55);
            overflow-y: auto;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        #game-logo {
            cursor: pointer; /* Menambahkan cursor pointer pada logo */
        }
        .simbol {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            border: 2px solid #5a677d;
            flex-shrink: 0;
        }
        .simbol:hover {
            transform: scale(1.1);
            border-color: #f7b733;
            box-shadow: 0 0 15px #f7b733;
        }
        .guess-slot {
            border: 2px dashed #4a5568;
            background-color: rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        .history-row {
            border-bottom: 1px solid #3a475d;
        }
        .modal {
            display: none;
        }
        .modal.show {
            display: flex;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f7b733;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .button-wrapper > button {
            margin: 0.5rem;
        }
        .flaming-title {
            color: #fefefe;
            text-shadow: 0 0 4px #fefefe, 0 0 10px #ffc400, 0 0 20px #ff8c00, 0 0 30px #ff4500;
            animation: fire-flicker 2s ease-in-out infinite alternate;
        }
        @keyframes fire-flicker {
            to {
                text-shadow: 0 0 6px #fefefe, 0 0 15px #ffc400, 0 0 25px #ff8c00, 0 0 40px #ff4500;
            }
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl text-center">
        <div class="flex justify-center items-center gap-4 mb-2">
            <img id="game-logo" src="https://scontent.fupg5-1.fna.fbcdn.net/v/t39.30808-6/490345769_9660946280610923_3421437977484593224_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=-Am4b4JcJOkQ7kNvwEOpiSc&_nc_oc=AdldSpgPUMKhQe1Y8OqXsNPpC94sNE4nN-SyI3lzM65XUJpWr-S9-SLYkMY_plwZdWI&_nc_zt=23&_nc_ht=scontent.fupg5-1.fna&_nc_gid=mYagCR9JPpvV14__7Pjw4w&oh=00_AfPnMsbCtpXJi-bc8vKK0yy4ovIgib1AYn6kq1m9GqDHfA&oe=686313F8" alt="Logo Game" class="w-16 h-16 md:w-20 md:h-20 rounded-full border-2 border-yellow-400 object-cover">
            <h1 class="text-5xl md:text-6xl font-cinzel font-bold flaming-title">Zky's Enigma</h1>
        </div>
        <p class="text-xl font-cinzel text-yellow-300 mb-4">Uji Logika, Ungkap Misteri.</p>
        <p class="mb-6 text-lg text-gray-400">Pecahkan urutan 4 simbol rahasia dalam 10 kesempatan.</p>
        <button id="get-prophecy" class="mb-4 bg-teal-600 hover:bg-teal-500 text-white font-bold py-2 px-5 rounded-full text-sm transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-teal-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Dengarkan Ramalan Oracle âœ¨</button>

        <div id="game-container" class="bg-gray-800 bg-opacity-50 p-6 rounded-2xl shadow-2xl border border-gray-700">
            
            <div class="mb-6">
                <h2 class="text-xl font-cinzel mb-3">Tebakan Anda</h2>
                <div id="current-guess-area" class="flex justify-center items-center space-x-2 md:space-x-4 h-20"></div>
            </div>

            <div class="mb-6">
                 <h2 class="text-xl font-cinzel mb-3">Pilih Simbol</h2>
                <div id="simbol-selection-area" class="flex flex-wrap justify-center items-center -m-1 md:-m-2 p-4 bg-black bg-opacity-20 rounded-lg"></div>
            </div>
            
            <div class="flex flex-wrap justify-center items-center button-wrapper">
                 <button id="submit-guess" class="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Tebak</button>
                 <button id="clear-guess" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none">Ulangi</button>
                 <button id="get-hint" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Minta Petunjuk âœ¨</button>
                 <button id="get-comment" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg text-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-400 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Komentar Oracle âœ¨</button>
            </div>
            <button id="ask-question" class="mt-4 bg-orange-700 hover:bg-orange-600 text-white font-bold py-2 px-5 rounded-full text-sm transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-500 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none">Ritual Pertanyaan (-1) âœ¨</button>
            <p class="mt-2 text-lg">Sisa Percobaan: <span id="attempts-left" class="font-bold">10</span></p>

        </div>
        
        <div id="history-container" class="w-full mt-6 bg-gray-800 bg-opacity-50 p-4 rounded-xl shadow-lg border border-gray-700 max-h-64 overflow-y-auto">
             <h3 class="text-xl font-cinzel mb-2 sticky top-0 bg-gray-800 bg-opacity-80 py-2">Riwayat</h3>
             <div id="history-log"></div>
        </div>
    </div>

    <!-- Modal Hasil Game -->
    <div id="resultModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 border-yellow-500 max-w-md w-full">
            <h2 id="modal-title" class="text-4xl font-cinzel font-bold mb-4"></h2>
            <p id="modal-message" class="text-lg mb-4"></p>
            <div class="mb-6">
                <p class="text-gray-400">Kode Rahasianya adalah:</p>
                <div id="secret-code-display" class="flex justify-center items-center space-x-2 mt-2"></div>
            </div>
            <div id="gemini-win-features" class="hidden">
                 <button id="get-lore" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-lg text-base mb-4">Ungkap Kisahnya âœ¨</button>
                 <div id="lore-result" class="text-base text-purple-200 bg-black bg-opacity-20 p-3 rounded-lg min-h-[6rem] flex items-center justify-center"></div>
            </div>
             <div id="gemini-lose-features" class="hidden">
                 <button id="get-analysis" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg text-base mb-4">Analisis Permainan Saya âœ¨</button>
            </div>
            <button id="restart-button" class="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-8 rounded-lg text-xl transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-yellow-400">
                Main Lagi
            </button>
        </div>
    </div>

    <!-- Modal Info Umum -->
    <div id="infoModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div id="info-modal-content-box" class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 max-w-md w-full">
            <h2 id="info-modal-title" class="text-3xl font-cinzel font-bold mb-4"></h2>
            <div id="info-modal-content" class="text-lg mb-6 min-h-[5rem] flex items-center justify-center text-left"></div>
            <button id="close-info-button" class="text-white font-bold py-2 px-6 rounded-lg">Tutup</button>
        </div>
    </div>
    
    <!-- Modal Pertanyaan -->
    <div id="questionModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 border-orange-500 max-w-md w-full">
            <h2 class="text-3xl font-cinzel font-bold mb-4 text-orange-400">Ritual Pertanyaan</h2>
            <p class="mb-4 text-gray-300">Ajukan satu pertanyaan kepada Oracle. Ini akan mengorbankan 1 sisa percobaan.</p>
            <input type="text" id="question-input" class="w-full bg-gray-700 text-white p-2 rounded-md mb-4 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-500" placeholder="Contoh: Apakah Simbol Api ada dalam kode?">
            <div class="flex justify-center gap-4">
                <button id="submit-question" class="bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-6 rounded-lg">Tanya</button>
                <button id="cancel-question" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Batal</button>
            </div>
        </div>
    </div>

    <!-- Modal Ganti Logo -->
    <div id="logoModal" class="modal fixed inset-0 bg-black bg-opacity-80 items-center justify-center p-4">
        <div class="bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-2 border-cyan-500 max-w-md w-full">
            <h2 class="text-3xl font-cinzel font-bold mb-4 text-cyan-400">Ganti Logo Game</h2>
            <p class="mb-4 text-gray-300">Masukkan URL gambar untuk logo baru.</p>
            <input type="url" id="logo-url-input" class="w-full bg-gray-700 text-white p-2 rounded-md mb-4 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500" placeholder="https://...gambar.jpg">
            <div class="flex justify-center gap-4">
                <button id="submit-logo" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg">Simpan</button>
                <button id="cancel-logo" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // --- Konfigurasi Game ---
        const SIMBOL_COUNT = 4;
        const MAX_ATTEMPTS = 10;
        const SIMBOLS = [
            { id: 1, name: "Simbol Malam", theme: "misteri, ilusi, malam", svg: '<path d="M12 2 A10 10 0 1 0 12 22 A8 8 0 1 1 12 2 Z" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#FFFFFF' },
            { id: 2, name: "Simbol Waktu", theme: "siklus, takdir, keabadian", svg: '<path d="M12,2 A10,10 0 0,1 22,12 A10,10 0 0,1 12,22 A10,10 0 0,1 2,12 A10,10 0 0,1 12,2" stroke="currentColor" stroke-width="1.5" fill="none" transform="rotate(90 12 12)"/><path d="M12,5 A7,7 0 0,1 19,12 A7,7 0 0,1 12,19 A7,7 0 0,1 5,12 A7,7 0 0,1 12,5" stroke="currentColor" stroke-width="1.5" fill="none" transform="rotate(-90 12 12)"/>', color: '#FFEB3B' },
            { id: 3, name: "Simbol Alam", theme: "pertumbuhan, alam, kebijaksanaan", svg: '<path d="M12 22 V 10 M 12 10 L 6 4 M 12 10 L 18 4 M 12 15 L 8 9 M 12 15 L 16 9" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#4CAF50' },
            { id: 4, name: "Simbol Rahasia", theme: "pengetahuan, rahasia, pembukaan", svg: '<circle cx="8" cy="8" r="4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M10 10 L 20 20 M 16 20 H 20 V 16" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#FF9800' },
            { id: 5, name: "Simbol Kekacauan", theme: "perubahan, emosi, kekacauan", svg: '<path d="M2 8 C 6 4, 8 12, 12 8 S 18 4, 22 8 M2 16 C 6 12, 8 20, 12 16 S 18 12, 22 16" stroke="currentColor" stroke-width="2" fill="none"/>', color: '#03A9F4' },
            { id: 6, name: "Simbol Kehidupan", theme: "kehidupan, esensi, inti", svg: '<path d="M12 5 C 9 2, 4 4, 4 9 C 4 14, 12 22, 12 22 C 12 22, 20 14, 20 9 C 20 4, 15 2, 12 5 Z" stroke="currentColor" stroke-width="1.5" fill="none"/>', color: '#E91E63' }
        ];

        // --- Elemen DOM ---
        const gameLogo = document.getElementById('game-logo');
        const logoModal = document.getElementById('logoModal');
        const logoUrlInput = document.getElementById('logo-url-input');
        const submitLogoBtn = document.getElementById('submit-logo');
        const cancelLogoBtn = document.getElementById('cancel-logo');
        const getProphecyBtn = document.getElementById('get-prophecy');
        const getHintBtn = document.getElementById('get-hint');
        const getCommentBtn = document.getElementById('get-comment');
        const askQuestionBtn = document.getElementById('ask-question');
        const questionModal = document.getElementById('questionModal');
        const questionInput = document.getElementById('question-input');
        const submitQuestionBtn = document.getElementById('submit-question');
        const cancelQuestionBtn = document.getElementById('cancel-question');
        const infoModal = document.getElementById('infoModal');
        const infoModalTitle = document.getElementById('info-modal-title');
        const infoModalContent = document.getElementById('info-modal-content');
        const infoModalContentBox = document.getElementById('info-modal-content-box');
        const closeInfoBtn = document.getElementById('close-info-button');
        const getLoreBtn = document.getElementById('get-lore');
        const loreResult = document.getElementById('lore-result');
        const geminiWinFeatures = document.getElementById('gemini-win-features');
        const getAnalysisBtn = document.getElementById('get-analysis');
        const geminiLoseFeatures = document.getElementById('gemini-lose-features');
        const currentGuessArea = document.getElementById('current-guess-area');
        const simbolSelectionArea = document.getElementById('simbol-selection-area');
        const submitGuessBtn = document.getElementById('submit-guess');
        const clearGuessBtn = document.getElementById('clear-guess');
        const attemptsLeftEl = document.getElementById('attempts-left');
        const historyLog = document.getElementById('history-log');
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const secretCodeDisplay = document.getElementById('secret-code-display');
        const restartButton = document.getElementById('restart-button');

        // --- State Game ---
        let secretCode = [], currentGuess = [], historyData = [];
        let attempts = MAX_ATTEMPTS;
        let isGameOver = false;

        function createSimbolElement(simbol, isInteractive = false) {
            const simbolEl = document.createElement('div');
            let classes = 'simbol w-12 h-12 md:w-14 md:h-14 bg-gray-700 rounded-lg flex items-center justify-center';
            if(isInteractive) {
                classes += ' m-1 md:m-2';
            }
            simbolEl.className = classes;
            simbolEl.innerHTML = `<svg viewBox="0 0 24 24" width="28" height="28" style="color: ${simbol.color};">${simbol.svg}</svg>`;
            if (isInteractive) simbolEl.onclick = () => handleSimbolSelection(simbol);
            return simbolEl;
        }

        function initGame() {
            isGameOver = false;
            attempts = MAX_ATTEMPTS;
            currentGuess = [];
            secretCode = [];
            historyData = [];
            
            let availableSimbols = [...SIMBOLS];
            for (let i = 0; i < SIMBOL_COUNT; i++) {
                const randomIndex = Math.floor(Math.random() * availableSimbols.length);
                secretCode.push(availableSimbols[randomIndex]);
                availableSimbols.splice(randomIndex, 1);
            }
            console.log("Kode Rahasia (untuk debugging):", secretCode.map(r => r.name).join(', '));

            simbolSelectionArea.innerHTML = '';
            SIMBOLS.forEach(simbol => simbolSelectionArea.appendChild(createSimbolElement(simbol, true)));
            
            historyLog.innerHTML = '';
            attemptsLeftEl.textContent = attempts;
            resultModal.classList.remove('show');
            submitGuessBtn.disabled = true;
            getHintBtn.disabled = true;
            getCommentBtn.disabled = true;
            askQuestionBtn.disabled = true;
            getProphecyBtn.disabled = false;
            geminiWinFeatures.classList.add('hidden');
            geminiLoseFeatures.classList.add('hidden');
            loreResult.innerHTML = '';
            getLoreBtn.disabled = false;
            getAnalysisBtn.disabled = false;
            
            renderCurrentGuess();
        }

        function renderCurrentGuess() {
            currentGuessArea.innerHTML = '';
            for(let i = 0; i < SIMBOL_COUNT; i++) {
                if(currentGuess[i]) {
                    currentGuessArea.appendChild(createSimbolElement(currentGuess[i]));
                } else {
                    const slot = document.createElement('div');
                    slot.className = 'guess-slot w-12 h-12 md:w-14 md:h-14';
                    currentGuessArea.appendChild(slot);
                }
            }
            submitGuessBtn.disabled = currentGuess.length !== SIMBOL_COUNT;
        }

        function handleSimbolSelection(simbol) {
            if (isGameOver || currentGuess.length >= SIMBOL_COUNT) return;
            if (!currentGuess.some(r => r.id === simbol.id)) {
                currentGuess.push(simbol);
                renderCurrentGuess();
            }
        }
        
        clearGuessBtn.addEventListener('click', () => {
             if (isGameOver) return;
             currentGuess = [];
             renderCurrentGuess();
        });

        submitGuessBtn.addEventListener('click', () => {
            if (isGameOver || currentGuess.length !== SIMBOL_COUNT) return;
            const { correctPosition, correctSimbol } = checkGuess();
            historyData.push({ guess: [...currentGuess], feedback: { correctPosition, correctSimbol }});
            addGuessToHistory(correctPosition, correctSimbol);
            
            attempts--;
            attemptsLeftEl.textContent = attempts;
            getProphecyBtn.disabled = true;
            
            if (correctPosition === SIMBOL_COUNT) {
                endGame(true);
            } else if (attempts === 0) {
                endGame(false);
            } else {
                getHintBtn.disabled = false;
                getCommentBtn.disabled = false;
                if(historyData.length >= 2) askQuestionBtn.disabled = false;
            }
            
            currentGuess = [];
            renderCurrentGuess();
        });

        function checkGuess() {
            let correctPosition = 0, correctSimbol = 0;
            const guessIds = currentGuess.map(r => r.id);
            const secretIds = secretCode.map(r => r.id);
            let checkedGuess = Array(SIMBOL_COUNT).fill(false);
            let checkedSecret = Array(SIMBOL_COUNT).fill(false);
            for (let i = 0; i < SIMBOL_COUNT; i++) {
                if (guessIds[i] === secretIds[i]) {
                    correctPosition++;
                    checkedGuess[i] = true;
                    checkedSecret[i] = true;
                }
            }
            for (let i = 0; i < SIMBOL_COUNT; i++) {
                if (checkedGuess[i]) continue;
                for (let j = 0; j < SIMBOL_COUNT; j++) {
                    if (checkedSecret[j]) continue;
                    if (guessIds[i] === secretIds[j]) {
                        correctSimbol++;
                        checkedSecret[j] = true;
                        break; 
                    }
                }
            }
            return { correctPosition, correctSimbol };
        }

        function addGuessToHistory(correctPosition, correctSimbol) {
            const historyRow = document.createElement('div');
            historyRow.className = 'history-row flex justify-between items-center p-2';

            const guessDisplay = document.createElement('div');
            guessDisplay.className = 'flex items-center space-x-2';
            currentGuess.forEach(simbol => {
                 const simbolEl = createSimbolElement(simbol);
                 simbolEl.classList.remove('md:w-14', 'md:h-14');
                 simbolEl.classList.add('w-8', 'h-8');
                 simbolEl.firstElementChild.setAttribute('width', '20');
                 simbolEl.firstElementChild.setAttribute('height', '20');
                 guessDisplay.appendChild(simbolEl);
            });
            
            const feedbackDisplay = document.createElement('div');
            feedbackDisplay.className = 'flex flex-col items-end text-sm text-gray-300';

            const correctPosEl = document.createElement('div');
            correctPosEl.className = 'flex items-center';
            correctPosEl.innerHTML = `
                <span>Posisi Tepat:</span>
                <span class="font-bold text-lg text-green-400 ml-2">${correctPosition}</span>
                <span class="ml-1 text-xl">âœ…</span>
            `;

            const correctRuneEl = document.createElement('div');
            correctRuneEl.className = 'flex items-center mt-1';
            correctRuneEl.innerHTML = `
                <span>Simbol Benar:</span>
                <span class="font-bold text-lg text-yellow-400 ml-2">${correctSimbol}</span>
                <span class="ml-1 text-xl">ðŸ”„</span>
            `;

            feedbackDisplay.appendChild(correctPosEl);
            feedbackDisplay.appendChild(correctRuneEl);
            
            historyRow.appendChild(guessDisplay);
            historyRow.appendChild(feedbackDisplay);
            historyLog.prepend(historyRow);
        }

        function endGame(isWin) {
            isGameOver = true;
            getHintBtn.disabled = true;
            getProphecyBtn.disabled = true;
            getCommentBtn.disabled = true;
            askQuestionBtn.disabled = true;
            secretCodeDisplay.innerHTML = '';
            secretCode.forEach(simbol => secretCodeDisplay.appendChild(createSimbolElement(simbol)));
            if(isWin) {
                modalTitle.textContent = "Selamat!";
                modalTitle.style.color = '#1dd1a1';
                modalMessage.textContent = `Anda berhasil memecahkan kode dalam ${MAX_ATTEMPTS - attempts} percobaan!`;
                geminiWinFeatures.classList.remove('hidden');
            } else {
                modalTitle.textContent = "Gagal!";
                modalTitle.style.color = '#ff6b6b';
                modalMessage.textContent = "Anda kehabisan percobaan. Coba lagi lain kali.";
                geminiLoseFeatures.classList.remove('hidden');
            }
            resultModal.classList.add('show');
        }
        
        restartButton.addEventListener('click', initGame);
        
        function showInfoModal(title, contentPromise, themeColor) {
            infoModal.classList.add('show');
            infoModalTitle.textContent = title;
            infoModalContentBox.style.borderColor = themeColor;
            closeInfoBtn.style.backgroundColor = themeColor;
            infoModalContent.innerHTML = '<div class="loader"></div>';

            contentPromise.then(content => {
                infoModalContent.innerHTML = `<p class="italic">"${content}"</p>`;
            }).catch(error => {
                console.error("Error showing modal content:", error);
                infoModalContent.innerHTML = `<p>Terjadi kesalahan saat memuat data. Pastikan API Key Anda valid.</p>`;
            });
        }
        
        closeInfoBtn.addEventListener('click', () => infoModal.classList.remove('show'));

        // --- Fitur Gemini API & Logo ---
        async function callGemini(prompt) {
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = "AIzaSyA0q2n614B7liPOnAyKEQmanjLd7H_lV9Q"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0].content.parts[0].text) {
                return result.candidates[0].content.parts[0].text.replace(/"/g, '');
            } else {
                throw new Error("No content received from Gemini.");
            }
        }
        
        function getHistoryAsText() {
            let text = '';
            historyData.forEach((item, index) => {
                const guessNames = item.guess.map(r => r.name).join(', ');
                text += `Tebakan ${index + 1}: [${guessNames}], Hasil: ${item.feedback.correctPosition} Posisi Tepat, ${item.feedback.correctSimbol} Simbol Benar (posisi salah).\n`;
            });
            return text;
        }

        gameLogo.addEventListener('click', () => {
            logoModal.classList.add('show');
        });

        cancelLogoBtn.addEventListener('click', () => {
            logoModal.classList.remove('show');
        });

        submitLogoBtn.addEventListener('click', () => {
            const newLogoUrl = logoUrlInput.value.trim();
            if (newLogoUrl) {
                gameLogo.src = newLogoUrl;
            }
            logoModal.classList.remove('show');
        });

        gameLogo.onerror = function() {
            this.src = 'https://placehold.co/80x80/243b55/f7b733?text=Zky';
            showInfoModal(
                "Kesalahan Gambar", 
                Promise.resolve("URL gambar yang Anda masukkan tidak valid atau tidak dapat dimuat. Logo telah dikembalikan ke default."), 
                '#ef4444' // red-500
            );
        };

        getProphecyBtn.addEventListener('click', () => {
            getProphecyBtn.disabled = true;
            const secretThemes = secretCode.map(r => r.theme).join(', ');
            const prompt = `Anda adalah Oracle di game Enigma Simbol. Kode rahasia memiliki tema: ${secretThemes}. Berikan ramalan puitis dua kalimat yang samar tentang tema-tema ini tanpa menyebutkan nama atau bentuk simbol. Ramalan ini harus dalam bahasa Indonesia. Contoh: 'Kekuatan yang menempa bumi bersatu dengan ketenangan samudra terdalam.'`;
            
            showInfoModal("Ramalan Sang Oracle", callGemini(prompt), '#14b8a6');
        });
        
        getHintBtn.addEventListener('click', () => {
            const prompt = `Anda adalah seorang ahli logika dalam permainan memecahkan kode bernama Enigma Simbol. Aturannya adalah menebak urutan 4 simbol unik dari 6 pilihan simbol. Pilihan simbol: ${SIMBOLS.map(r => r.name).join(', ')}. Petunjuk: 'Posisi Tepat' berarti 1 simbol benar di posisi yang tepat. 'Simbol Benar' berarti 1 simbol benar tapi di posisi yang salah. Berikut adalah riwayat tebakan sejauh ini:\n${getHistoryAsText()} Berdasarkan riwayat di atas, berikan satu petunjuk atau deduksi logis yang berguna untuk tebakan selanjutnya. Jangan berikan jawaban langsung. Berikan dalam format singkat dan padat. Berikan dalam bahasa Indonesia.`;
            showInfoModal("Petunjuk dari Sang Oracle", callGemini(prompt), '#3b82f6');
        });

        getCommentBtn.addEventListener('click', () => {
            if (historyData.length === 0) return;
            const lastGuess = historyData[historyData.length - 1];
            const guessNames = lastGuess.guess.map(r => r.name).join(', ');
            const feedback = `${lastGuess.feedback.correctPosition} Posisi Tepat, ${lastGuess.feedback.correctSimbol} Simbol Benar`;
            const prompt = `Anda adalah Oracle yang sedikit sombong dan misterius di game Enigma Simbol. Seorang pemain baru saja membuat tebakan [${guessNames}] dan hasilnya adalah ${feedback}. Berikan satu kalimat komentar yang puitis, samar, atau sedikit mengejek tentang tebakan mereka. Jangan berikan petunjuk langsung. Gunakan bahasa Indonesia.`;
            showInfoModal("Komentar Sang Oracle", callGemini(prompt), '#6366f1');
        });
        
        askQuestionBtn.addEventListener('click', () => {
            questionModal.classList.add('show');
        });
        
        cancelQuestionBtn.addEventListener('click', () => {
            questionModal.classList.remove('show');
        });

        submitQuestionBtn.addEventListener('click', () => {
            const question = questionInput.value.trim();
            if (!question) return;

            questionModal.classList.remove('show');
            
            attempts--;
            attemptsLeftEl.textContent = attempts;
            
            const secretSimbolNames = secretCode.map(r => r.name);
            const prompt = `Anda adalah Oracle di game Enigma Simbol. Anda harus menjawab pertanyaan dari pemain dengan jawaban "Ya" atau "Tidak" yang dibungkus kalimat puitis. Jangan bertele-tele. Konteks kode rahasia: [${secretSimbolNames.join(', ')}]. Pertanyaan pemain: "${question}". Jawab dalam bahasa Indonesia.`;
            
            showInfoModal("Jawaban Sang Oracle", callGemini(prompt), '#d97706');
            questionInput.value = '';

            if (attempts === 0) {
                setTimeout(() => endGame(false), 500);
            }
        });


        getLoreBtn.addEventListener('click', async () => {
            getLoreBtn.disabled = true;
            loreResult.innerHTML = '<div class="loader mx-auto"></div>';
            const solvedCodeNames = secretCode.map(r => r.name).join(', ');
            const prompt = `Anda adalah seorang penyair dan penjaga hikayat kuno. Tuliskan sebuah legenda atau cerita pendek (sekitar 2-3 kalimat) tentang sebuah kombinasi simbol sakral yang dikenal sebagai "${solvedCodeNames}". Ceritanya harus mistis dan menarik. Gunakan bahasa Indonesia.`;
            
            try {
                const lore = await callGemini(prompt);
                loreResult.innerHTML = `<p>${lore}</p>`;
            } catch (error) {
                loreResult.textContent = "Kisah simbol ini telah hilang ditelan waktu.";
            }
        });

        getAnalysisBtn.addEventListener('click', () => {
             const prompt = `Anda adalah seorang pelatih logika yang menganalisis permainan Enigma Simbol. Berikan analisis singkat dan satu saran strategis berdasarkan riwayat tebakan pemain berikut. Tujuannya adalah untuk membantu pemain berpikir lebih baik di permainan selanjutnya. Jangan terlalu keras, berikan semangat. Gunakan bahasa Indonesia.\n\nRiwayat Tebakan:\n${getHistoryAsText()}`;
             
             showInfoModal("Analisis Permainan", callGemini(prompt), '#dc2626');
        });

        initGame();
    </script>
</body>
</html>
